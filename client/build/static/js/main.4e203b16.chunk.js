(this.webpackJsonptimebandit=this.webpackJsonptimebandit||[]).push([[0],{1:function(e){e.exports=JSON.parse('{"aux_primary":"#FAE4E8","aux_secondary":"#301C0F","secondary":"#F2EED8","secondary_light2":"#F2EFE8","secondary_light":"#F2F4E8","primary":"#0D0D0D","primary_shadow":"#9D8D8D","WIDTH":1200,"HEIGHT":800,"FONT_DEFAULT_SIZE":12,"DEBUG_HEIGHT":200,"DEBUG_TEXT":12,"PANES_WIDTH":10,"WINDOW_PERCENTAGE":0.8,"DRAG_THRESHOLD_X":10,"FLAT_THRESHOLD":10,"NUDGE_THRESHOLD":0.5,"SNAP_THRESHOLD":50,"INST_HEIGHT":100,"SCROLL_SENSITIVITY":100,"ROLLOVER_TOLERANCE":3,"TIMESIG_PADDING":5,"TEMPO_PADDING":5,"TEMPO_PT":8,"TOOLBAR_WIDTH":200,"META_HEIGHT":200,"REHEARSAL_HEIGHT":150,"LOG_HEIGHT":300,"LOG_WIDTH":200,"TRACKING_HEIGHT":20,"TRACKING_PADDING":{"X":20,"Y":5},"CANVAS_PADDING":20,"INSERT_HEIGHT":100,"INSERT_PADDING":4,"INSERT_WIDTH":250,"EDITOR_HEIGHT":100,"EDITOR_PADDING":4,"EDITOR_WIDTH":500,"LOCK_HEIGHT":20,"PREVIEW_HEIGHT":20,"FOOTER_HEIGHT":100,"FOOTER_PADDING":20,"PPQ_OPTIONS":[[24,"default"],[4,"ableton live"],[256,"sibelius"],[480,"digital performer"],[960,"reaper"],[1024,"finale"]],"TRACK_HEIGHT":100,"PLAYBACK_HEIGHT":25,"DELTA_THRESHOLD":5,"PPQ_default":48}')},12:function(e,t){for(var n=window.navigator.platform.indexOf("Mac")>=0,s=n?224:17,a=n?17:91,i=[],r=48;r<58;r++)i.push(r);e.exports={SHIFT:16,ALT:18,SPACE:32,DEL:46,BACK:8,ESC:27,CTRL:s,MOD:a,KeyC:67,KeyI:73,KeyV:86,KeyH:72,KeyJ:74,KeyK:75,KeyL:76,KeyZ:90,NUM:i}},141:function(e,t){},144:function(e,t,n){"use strict";n.r(t);for(var s=n(0),a=n.n(s),i=n(20),r=n.n(i),o=(n(98),n(62),n(25)),c=n(13),l=n(5),u=n(14),d=n(17),m=n(9),f=n(48),p=n(47),h=n(26),g=n.n(h),T=n(23),E=n.n(T),b=n(16),v=n.n(b),I=n(78),P=n.n(I),_=function e(t,n){Object(u.a)(this,e),this.type="tempo";var s=Math.round(6e7/n);this.data=v.a.Utils.numberToVariableLength(t).concat(255,81,[3],v.a.Utils.numberToBytes(s,3))},O=function e(t,n,s,a){Object(u.a)(this,e),this.type="time-signature",this.data=v.a.Utils.numberToVariableLength(0).concat(255,88,[4],v.a.Utils.numberToBytes(t,1),v.a.Utils.numberToBytes(Math.log2(n),1),v.a.Utils.numberToBytes(a||24,1),v.a.Utils.numberToBytes(s||8,1)),console.log(this.data)},H=new(window.AudioContext||window.webkitAudioContext),y={},N=[],k=[],A=[],S=[],w=0;w<5;w++){var x=H.createGain();x.gain.setValueAtTime(0,H.currentTime),S.push(x)}S.forEach((function(e){return e.connect(H.destination)}));var D={sustain:50,adsr:[50,200,.5,10],lookahead:25,scheduleAheadTime:.1},G=[];function M(e,t){var n=1e3*H.currentTime-e,s=n+1e3*D.scheduleAheadTime,a=[];!function e(t){if(void 0!==t){var i=[];t.loc>n&&t.loc<s?(a.push({time:t.loc-n,inst:t.meas.map((function(e){return e.inst}))}),i.push(t.left),i.push(t.right)):t.loc>s?i.push(t.left):t.loc<n&&i.push(t.right),i.forEach((function(t){return e(t)}))}}(t),G.forEach((function(e){return clearTimeout(e)})),G=[],a.forEach((function(e){G.push(function(e,t){for(var n=t.map((function(e){return e/1e3})),s=0;s<e.inst.length;s++){var a=H.currentTime+e.time/1e3,i=e.inst[s];S[i].gain.setValueAtTime(0,a),S[i].gain.linearRampToValueAtTime(.7,a+n[0]),S[i].gain.linearRampToValueAtTime(n[2],a+n[0]+n[1]),S[i].gain.linearRampToValueAtTime(n[2],a+n[0]+n[1]+D.sustain),S[i].gain.linearRampToValueAtTime(0,a+n[0]+n[1]+D.sustain+n[3])}return setTimeout((function(){return A.forEach((function(t){return t(e.inst)}))}),e.time)}(e,D.adsr)),k.forEach((function(t){return t(e)}))}));var i=window.setTimeout((function(){M(e,t)}),D.lookahead);G.push(i)}for(var R,j=function(e,t,n){n=n||0,e?(y={origin:n/1e3,start:H.currentTime},"suspended"===H.state&&H.resume(),M(1e3*H.currentTime-n,t)):(G.forEach((function(e){return window.clearTimeout(e)})),S.forEach((function(e){e.gain.cancelScheduledValues(H.currentTime),e.gain.linearRampToValueAtTime(e.gain.value,H.currentTime),e.gain.linearRampToValueAtTime(0,H.currentTime+.05)})))},C={init:function(){return H.resume().then((function(){return console.log("resumed")}))},play:j,kill:function(){return j(!1)},set:function(e,t){D[e]=t},subscribe:function(e){return N.push(e)},triggerHook:function(e){return A.push(e)},schedulerHook:function(e){return k.push(e)},context:H,locator:function(){return 1e3*(H.currentTime-y.start+y.origin)}},L=n(79),Q=n.n(L),W=n(80),F=n.n(W),B=function(e,t){var n,s,a,i,r,o;n=e.start,s=e.end,a=e.timesig,i=t.PPQ,r=t.PPQ_tempo;for(var c=[],l=[],u=t.PPQ*a,d=0,m=(s-n)/u,f=6e4/i,p=i/r,h=0,g=0;g<u;g++)g%i||c.push(d),l.push(d),g%p===0&&(h=f/(n+m*g)),d+=h;return o=d,c.push(o),{start:n,end:s,timesig:a,beats:c,ms:o,ticks:l,offset:e.offset}},K=function(e,t){return function e(n){var s=Math.floor(n.length/2);return s?function(e,n){for(var s=0,a=0,i=[];s<e.length&&a<n.length;)i.push(e[s][t]<n[a][t]?e[s++]:n[a++]);return i.concat(e.slice(s)).concat(n.slice(a))}(e(n.slice(0,s)),e(n.slice(s))):n}(Object.keys(e).map((function(t){return e[t]})))},Y=function(e,t,n){var s=[-1,1/0],a=[-1,1/0];return t.some((function(t,i){return s=[i,Math.abs(e[n]-t[n])],a[1]<s[1]||(a=[i,s[1]],!1)})),a[0]},U=function(e){for(var t=[],n=0;e;)1&e&&t.push(n),e>>=1,n+=1;return t},z=n(50),V=n.n(z),X=n(18),Z=n.n(X),J=n(7),q=n(8),$=n(81),ee=n.n($),te=n(51),ne=n(1),se={tempo:function(e){return"ns-resize"},inst:function(e){return"default"},measure:function(e){return e.shift?"ew-resize":"default"},beat:function(e){return e.ctrl?e.shift?"text":"pointer":"default"}},ae=n(12),ie=n.n(ae),re=function(e,t,n){return new(function(){function s(){Object(u.a)(this,s),this.lines=[],this.defaults=[]}return Object(d.a)(s,[{key:"frameRate",value:function(){e.textAlign(e.RIGHT,e.TOP),e.textSize(18),e.stroke(ne.primary),e.fill(ne.primary),e.text("".concat(Math.round(e.frameRate()),"fps"),e.width-10,5)}},{key:"push",value:function(e){var t=this;Array.isArray(e)?e.forEach((function(e){return t.lines.push(e)})):this.lines.push(e)}},{key:"write",value:function(s,a){var i=a||ne.FONT_DEFAULT_SIZE,r=function(e){return i*e+s.y};e.stroke(ne.primary),e.textSize(ne.DEBUG_TEXT),e.textAlign(e.LEFT,e.TOP),this.push([t.selected.meas?"Window.selected - start: ".concat(t.selected.meas.start.toFixed(2),", end: ").concat(t.selected.meas.end.toFixed(2),", ms: ").concat(t.selected.meas.ms.toFixed(2)):"Window.selected - none",t.selected.meas&&"temp"in t.selected.meas?"temp - start: ".concat(t.selected.meas.temp.start.toFixed(2),", end: ").concat(t.selected.meas.temp.end.toFixed(2),", ms: ").concat(t.selected.meas.temp.ms.toFixed(2)):"temp - none","rollover - type: ".concat(n.rollover.type,", inst: ").concat(n.rollover.inst,", meas: ").concat("meas"in n.rollover?n.rollover.meas.id:void 0,", index: ").concat(n.rollover.beat),"drag - mode: ".concat(n.drag.mode),t.selected.meas?["Window.selected: ".concat("temp"in t.selected.meas?[t.selected.meas.temp.start,t.selected.meas.temp.end].join(" "):"no temp","  beats - ").concat(t.selected.meas.ms.toFixed(1)," ms")]:[""]]),this.lines.forEach((function(t,n){return e.text(t,s.x,r(n))})),e.textAlign(e.CENTER,e.CENTER),e.push(),e.translate(0,r(this.lines.length)+5),e.fill(240),e.textSize(8),[{name:"MOD",code:ae.MOD},{name:"SHIFT",code:ae.SHIFT},{name:"CTRL",code:ae.CTRL},{name:"ALT",code:ae.ALT},{name:"C",code:ae.KeyC},{name:"V",code:ae.KeyV}].forEach((function(t,n){e.keyIsDown(t.code)&&e.fill(120),e.rect(5+25*n,0,20,15),e.fill(240),e.text(t.name,15+25*n,7)})),e.push(),e.translate(0,20),ae.NUM.forEach((function(t,n){e.keyIsDown(t)&&e.fill(120),e.rect(5+25*n,0,20,15),e.fill(240),e.text(n,15+25*n,7)})),e.pop(),e.pop()}},{key:"clear",value:function(){this.lines=[]}}]),s}())},oe=window.navigator.platform.indexOf("Mac")>=0,ce=oe?224:17,le=oe?17:91,ue=[],de=48;de<58;de++)ue.push(de);var me={},fe=[0,100];function pe(e){var t,n=[],s=0,a={divs:[],div_index:0,snapped_inst:{}},i=!1,r=!1,m=!1,f=function(e){return new(function(){function t(){Object(u.a)(this,t),this.scale=1,this.viewport=0,this.span=[1/0,-1/0],this.mode=0,this.panels=!1,this.selected={inst:-1,meas:void 0},this.insts=0,this.mods={},this.insertMeas={},this.editMeas={}}return Object(d.a)(t,[{key:"initialize_temp",value:function(){this.selected.meas.temp={start:this.selected.meas.start,end:this.selected.meas.end,ms:this.selected.meas.ms,ticks:this.selected.meas.ticks,beats:this.selected.meas.beats,offset:this.selected.meas.offset}}},{key:"updateView",value:function(t,n){if(n.zoom){var s=1-t.delta/ne.SCROLL_SENSITIVITY;this.scale*=s,this.viewport=e.mouseX-s*(e.mouseX-this.viewport)}this.viewport-=t.deltaX}},{key:"drawTimesig",value:function(t,n){var s="string"===typeof n?n:parseInt(n,10);e.push(),e.translate(ne.TIMESIG_PADDING,ne.TIMESIG_PADDING),e.fill(100),e.textSize(.25*ne.INST_HEIGHT),e.textLeading(.2*ne.INST_HEIGHT),e.textAlign(e.LEFT,e.CENTER),e.text([t,s].join("\n"),0,ne.INST_HEIGHT/2),e.pop()}},{key:"select",value:function(e){if(this.selected.meas){if(this.selected.meas.id===e.meas.id)return!1;this.editMeas={},delete this.selected.meas.temp}Object.assign(this.selected,e)}},{key:"drawFrame",value:function(){e.stroke(ne.secondary_light),e.fill(ne.secondary_light),e.rect(0,0,e.width,e.height),e.stroke(ne.secondary),e.fill(ne.secondary),e.rect(0,0,e.width,ne.PLAYBACK_HEIGHT),e.stroke(ne.secondary),e.fill(ne.secondary),e.rect(0,e.height-ne.TRACKING_HEIGHT,e.width,ne.TRACKING_HEIGHT)}},{key:"drawTabs",value:function(t){var n=t.locator,s=t.cursor_loc,a=t.isPlaying;e.push(),e.stroke(ne.primary),e.fill(ne.primary),e.translate(0,e.height-ne.TRACKING_HEIGHT),e.rect(0,0,e.width,ne.TRACKING_HEIGHT),e.push(),e.stroke(ne.secondary),e.fill(ne.secondary),e.textAlign(e.LEFT,e.TOP),e.textSize(10),e.text(a?"LOCATION: ".concat(n):"CURSOR: ".concat(s),ne.TRACKING_PADDING.X,ne.TRACKING_PADDING.Y),e.textAlign(e.RIGHT,e.TOP);var i=this.span.map((function(e){return e.toFixed(2)})),r=i[1]-i[0];e.text("".concat(i[0]," - ").concat(i[1],", \u2248 ").concat(Math.floor(r/6e4),"'").concat(Math.floor(r/1e3)%60,'"'),e.width-ne.TOOLBAR_WIDTH-ne.TRACKING_PADDING.X,ne.TRACKING_PADDING.Y),e.pop(),e.translate((e.width-ne.TOOLBAR_WIDTH)/3,0),e.textSize(8),e.textAlign(e.LEFT,e.CENTER),e.stroke(ne.secondary),e.fill(ne.secondary),e.line(0,0,0,ne.TRACKING_HEIGHT),e.line(ne.INSERT_WIDTH,0,ne.INSERT_WIDTH,ne.TRACKING_HEIGHT),e.translate(ne.INSERT_PADDING,0),e.text("- INSERT",0,ne.TRACKING_HEIGHT/2),e.text("- EDITOR",ne.INSERT_WIDTH,ne.TRACKING_HEIGHT/2),e.pop()}},{key:"_scaleY",value:function(e,t,n){return t-(e-n.tempo[0])/(n.tempo[1]-n.tempo[0])*t}},{key:"drawToolbar",value:function(t){var n=this;if(e.push(),e.stroke(ne.primary),e.fill(ne.primary),e.translate((e.width-ne.TOOLBAR_WIDTH)/3,e.height-ne.TRACKING_HEIGHT-ne.INSERT_HEIGHT),1===this.mode){if(e.push(),e.rect(0,0,ne.EDITOR_WIDTH,ne.INSERT_HEIGHT),e.stroke(ne.secondary),e.line(ne.INSERT_WIDTH,ne.EDITOR_HEIGHT,ne.EDITOR_WIDTH,ne.EDITOR_HEIGHT),"beats"in this.insertMeas){e.stroke(ne.secondary),e.fill(ne.secondary),e.push(),e.translate(ne.INSERT_PADDING,ne.INSERT_PADDING);var s=ne.EDITOR_WIDTH-2*ne.INSERT_PADDING;this.insertMeas.beats.forEach((function(t){var a=t/n.insertMeas.ms*s;e.line(a,0,a,ne.PREVIEW_HEIGHT)}));var a=this._scaleY(this.insertMeas.start,ne.PREVIEW_HEIGHT,t),i=this._scaleY(this.insertMeas.end,ne.PREVIEW_HEIGHT,t);e.line(0,a,s,i),e.push(),e.translate(0,ne.PREVIEW_HEIGHT+ne.INSERT_PADDING),e.textAlign(e.LEFT,e.TOP),e.pop(),e.pop()}e.pop()}if(2===this.mode&&(e.rect(0,0,ne.EDITOR_WIDTH,ne.EDITOR_HEIGHT),e.stroke(ne.secondary),e.line(0,ne.EDITOR_HEIGHT,ne.INSERT_WIDTH,ne.EDITOR_HEIGHT),this.selected.meas)){e.push(),e.stroke(ne.secondary),e.translate(ne.INSERT_PADDING,ne.INSERT_PADDING);var r=ne.EDITOR_WIDTH-2*ne.INSERT_PADDING,o=this.selected.meas;o.beats.forEach((function(t){var n=t/o.ms*r;e.line(n,0,n,ne.PREVIEW_HEIGHT)}));var c=this._scaleY(o.start,ne.PREVIEW_HEIGHT,t),l=this._scaleY(o.end,ne.PREVIEW_HEIGHT,t);e.line(0,c,r,l),e.pop()}e.pop()}},{key:"drawEditorFrame",value:function(t,n){e.push();var s=e.color(ne.primary);s.setAlpha(180),e.stroke(s),e.fill(s),e.translate.apply(e,Object(o.a)(t)),n&&e.ellipse.apply(e,Object(o.a)(n));for(var a=ne.PANES_WIDTH/4,i=180/ne.INST_HEIGHT,r=e.color(ne.primary),c=this.selected.meas.ms*this.scale,l=0;l<=ne.INST_HEIGHT;l++)r.setAlpha(l*i),e.stroke(r),e.line(-a,l,0,l),e.line(c,l,c+a,l);e.translate(0,ne.INST_HEIGHT),e.rect(-a,0,2*a+this.selected.meas.ms*this.scale,ne.LOCK_HEIGHT),e.stroke(ne.secondary),e.fill(ne.secondary),e.textSize(10),e.textAlign(e.LEFT,e.CENTER),e.pop()}}]),t}())}(e),p=function(e,t){return new(function(){function n(){Object(u.a)(this,n),this.checkOrigin=function(e){if(e.mouseX===1/0||e.mouseX<0||e.mouseY===1/0||e.mouseY<0||e.mouseY>e.height)return!0;var n=Math.floor((e.mouseY-ne.PLAYBACK_HEIGHT)/ne.INST_HEIGHT);if(2===t.mode&&t.selected.meas){var s=ne.PANES_WIDTH+t.selected.meas.offset*t.scale+t.viewport,a=n*ne.INST_HEIGHT+ne.PLAYBACK_HEIGHT;if(e.mouseY>a&&e.mouseY<a+ne.LOCK_HEIGHT&&e.mouseX>s&&e.mouseX<s+t.selected.meas.ms*t.scale)return!0}return!1},this.grabbed=0,this.drag={x:0,y:0,mode:""},this.outside_origin=!0,this.rollover={},this._rollover={},this.cursor="default",this.translate=[]}return Object(d.a)(n,[{key:"select",value:function(){var n=Math.floor((e.mouseY-ne.PLAYBACK_HEIGHT)/ne.INST_HEIGHT);if(n>=t.insts)this.outside_origin=!0;else{var s={ind:this.rollover.ind,inst:n,meas:this.rollover.meas};g.a.isEqual(s,t.selected)||(t.selected=s,this.outside_origin=!0)}}},{key:"tickMode",value:function(){var e=t.selected.meas;t.initialize_temp(),this.grabbed=this.rollover.beat===e.beats.length-1?6e4/e.beats.slice(-1)[0]:6e4/e.ticks[this.rollover.beat*t.CONSTANTS.PPQ],t.selected.dir=e.end>e.start?1:e.start>e.end?-1:0,this.drag.mode="tick",this.drag.grab=this.rollover.beat}},{key:"measureMode",value:function(){t.initialize_temp(),this.drag.mode="measure"}},{key:"beatLock",value:function(e){var n,s;t.selected.meas.id in e||(e[t.selected.meas.id]={beats:[],meta:{}}),(U(e[t.selected.meas.id].beats).length<2||-1!==U(e[t.selected.meas.id].beats).indexOf(this.rollover.beat))&&(e[t.selected.meas.id].beats=(n=e[t.selected.meas.id].beats,s=this.rollover.beat,n^1<<s))}},{key:"clickTempo",value:function(){this.drag.mode="tempo",t.initialize_temp(),this.drag.grab=this.rollover.beat,this.grabbed=this.rollover.beat}},{key:"rolloverCheck",value:function(n,s){var a=this,i=0;2===n.length&&(n.push(n[0]),n.push(n[1]),i=5);return(null===n[0]||e.mouseX>=a.loc.x+n[0]-i&&e.mouseX<a.loc.x+n[2]+i)&&(null===n[1]||e.mouseY>=a.loc.y+n[1]-i&&e.mouseY<a.loc.y+n[3]+i)&&(Object.assign(this._rollover,s),this.cursor=s.meas&&t.selected.meas&&s.meas.id===t.selected.meas.id?se[s.type](t.mods):"default",!0)}},{key:"dragCursorUpdate",value:function(){"measure"===this.drag.mode?this.cursor="ew-resize":"tempo"===this.drag.mode?this.cursor="ns-resize":"tick"===this.drag.mode&&(this.cursor="text")}},{key:"updateRollover",value:function(){this.rollover=this._rollover,this._rollover={}}},{key:"push",value:function(e){var t=this.translate.slice(-1)[0];t?this.translate.push({x:t.x+e.x,y:t.y+e.y}):this.translate.push(e)}},{key:"pop",value:function(){return this.translate.pop()}},{key:"updatePress",value:function(){return this.drag={x:0,y:0},this.outside_origin=this.checkOrigin(e),!!this.outside_origin||"tempo"===this.rollover.type&&(this.clickTempo(),!0)}},{key:"loc",get:function(){return this.translate.slice(-1)[0]}}]),n}())}(e,f),h=function(e){return new(function(){function t(){Object(u.a)(this,t),this.held_nums=[],this.num_counter=0}return Object(d.a)(t,[{key:"checkNumPress",value:function(){var t=ae.NUM.indexOf(e.keyCode);return t>=0&&(this.held_nums.push(t),this.num_counter++,console.log(this.held_nums,this.num_counter),!0)}},{key:"checkNumRelease",value:function(){var t=ae.NUM.indexOf(e.keyCode);return t>=0&&this.held_nums.indexOf(t)>=0&&(this.num_counter--,this.num_counter||(this.held_nums=[]),console.log(this.held_nums,this.num_counter),!0)}},{key:"checkDirection",value:function(){return e.keyCode===ae.KeyJ?"DOWN":e.keyCode===ae.KeyK?"UP":e.keyCode===ae.KeyH?"LEFT":e.keyCode===ae.KeyL&&"RIGHT"}}]),t}())}(e),T=re(e,f,p);e.setup=function(){e.createCanvas(e.windowWidth-2*ne.CANVAS_PADDING,e.windowHeight-ne.FOOTER_HEIGHT),e.background(255)},e.windowResized=function(){e.resizeCanvas(e.windowWidth-2*ne.CANVAS_PADDING,e.windowHeight-ne.FOOTER_HEIGHT)},e.myCustomRedrawAccordingToNewPropsHandler=function(e){n=e.instruments,f.insertMeas=e.insertMeas,f.editMeas=e.editMeas,f.panels=e.panels,f.mode=e.mode,f.insts=e.instruments.length,R=e.API,f.CONSTANTS=e.CONSTANTS;var t=f.selected.meas&&f.selected.meas.id in me&&me[f.selected.meas.id].beats?U(me[f.selected.meas.id].beats):[];f.selected.inst>-1&&f.selected.meas&&(f.selected.meas=n[f.selected.inst].measures[f.selected.meas.id]),"ms"in f.editMeas?(f.selected.meas.temp=f.editMeas,1===t.length&&(f.selected.meas.temp.offset=f.selected.meas.temp.offset+f.selected.meas.beats[t[0]]-f.editMeas.beats[t[0]])):f.selected.meas&&"temp"in f.selected.meas&&delete f.selected.meas.temp,"locks"in e&&(s=e.locks.reduce((function(e,t){return e|1<<t}),0)),n.forEach((function(e){if(e.ordered=K(e.measures,"offset"),e.ordered.length){var t=e.ordered[e.ordered.length-1];f.span=[Math.min(f.span[0],e.ordered[0].offset),Math.max(f.span[1],t.offset+t.ms)]}})),Z.a.log("Recalculating snap divisions..."),a.divs=ue.slice(1).reduce((function(e,t,s){var a={},i=f.CONSTANTS.PPQ/(s+1);return n.forEach((function(e,t){return e.ordered.forEach((function(e){for(var n=0;n<e.ticks.length;n+=i){var s=Math.round(n),r=((s>=e.ticks.length?e.ms:e.ticks[s])+e.offset).toString(),o={inst:t,meas:e.id};r in a?a[r].push(o):a[r]=[o]}}))}),{}),[].concat(Object(o.a)(e),[a])}),[]),fe=f.CONSTANTS.range},e.draw=function(){e.frameRate(10),p.cursor="default",["CTRL","SHIFT","MOD","ALT"].forEach((function(t){return Object.assign(f.mods,Object(c.a)({},t.toLowerCase(),e.keyIsDown(ie.a[t])))})),a.div_index=h.num_counter?h.held_nums[h.held_nums.length-1]-1:0,f.drawFrame(),e.push(),p.push({x:ne.PANES_WIDTH,y:ne.PLAYBACK_HEIGHT}),e.translate(0,ne.PLAYBACK_HEIGHT),e.stroke(ne.primary),e.fill(ne.primary),e.rect(0,0,ne.PANES_WIDTH,e.height),e.translate(ne.PANES_WIDTH,0);var t={};n.forEach((function(n,s){var i=s*ne.INST_HEIGHT;if(e.push(),e.translate(0,i),p.push({x:0,y:i}),""===p.drag.mode&&p.rolloverCheck([null,0,null,ne.INST_HEIGHT],{type:"inst",inst:s}),e.stroke(255,0,0),e.fill(ne.secondary_light2),f.selected.meas||f.selected.inst!==s||e.fill(230),e.rect(0,0,e.width-1,99),n.ordered.forEach((function(n,s){var a=n.id,i="temp"in n,r=i?[n.temp.ticks,n.temp.beats,n.temp.offset,n.temp.beats.slice(-1)[0],n.temp.start||n.start,n.temp.end||n.end]:[n.ticks,n.beats,n.offset,n.beats.slice(-1)[0],n.start,n.end],o=Object(te.a)(r,6),c=o[0],l=o[1],u=o[2],d=o[3],m=o[4],h=o[5],g=function(e){return e*f.scale+f.viewport},T=g(u),E=d*f.scale;if(!(T+E<0||T>e.width)){e.push(),e.translate(T,0),p.push({x:T,y:0}),""===p.drag.mode&&p.rolloverCheck([0,0,E,ne.INST_HEIGHT],{ind:s,type:"measure",meas:n}),f.selected.meas&&a===f.selected.meas.id&&(e.fill(0,255,0,60),e.rect(0,0,E,ne.INST_HEIGHT)),e.stroke(240);var b=1;f.scale<1&&(b=f.scale<.05?f.scale<.025?f.CONSTANTS.PPQ:2*f.CONSTANTS.PPQ_mod:f.CONSTANTS.PPQ_mod);for(var v=0;v<c.length;v+=b){var I=c[v]*f.scale;I+T>e.width||I+T<0||e.line(I,0,I,ne.INST_HEIGHT)}f.drawTimesig(n.timesig,"4"),l.forEach((function(n,s){var r=n*f.scale,o=255,c=a in me&&me[a].beats&1<<s?[0,0,255]:[255,0,0];if(!i&&p.rolloverCheck([r-ne.ROLLOVER_TOLERANCE,0,r+ne.ROLLOVER_TOLERANCE,ne.INST_HEIGHT],{type:"beat",beat:s})&&(o=100,f.mods.ctrl&&f.selected.meas&&(p.cursor=f.mods.shift?"text":"pointer",a in me))){var l=U(me[a].beats);(l.length>=2&&-1===l.indexOf(t.beat)&&!f.mods.shift||-1!==l.indexOf(t.beat)&&f.mods.shift)&&(p.cursor="not-allowed")}e.stroke.apply(e,c.concat([o])),e.line(r,0,r,ne.INST_HEIGHT)})),p.pop(),e.stroke(240,200,200);var P="temprange"in fe&&fe.temprange[0]||fe.tempo[0],_=("temprange"in fe&&fe.temprange[1]||fe.tempo[1])-P,O=ne.INST_HEIGHT-(m-P)/_*ne.INST_HEIGHT,H=ne.INST_HEIGHT-(h-P)/_*ne.INST_HEIGHT,y=[0,O];l.slice(1).forEach((function(t,s){var a=[t*f.scale,ne.INST_HEIGHT-((s+1)/n.timesig*(h-m)+m-P)/_*ne.INST_HEIGHT];e.line(y[0],y[1],a[0],a[1]),y=a})),e.fill(100),e.textSize(ne.TEMPO_PT);var N={x:g(0)+ne.TEMPO_PADDING};O>ne.TEMPO_PT+ne.TEMPO_PADDING?(e.textAlign(e.LEFT,e.BOTTOM),N.y=O-ne.TEMPO_PADDING):(e.textAlign(e.LEFT,e.TOP),N.y=O+ne.TEMPO_PADDING),e.text(m.toFixed(2),ne.TEMPO_PADDING,N.y),N={x:g(d)-ne.TEMPO_PADDING},H>ne.TEMPO_PT+ne.TEMPO_PADDING?(e.textAlign(e.RIGHT,e.BOTTOM),N.y=H-ne.TEMPO_PADDING):(e.textAlign(e.RIGHT,e.TOP),N.y=H+ne.TEMPO_PADDING),e.text(h.toFixed(2),d*f.scale-ne.TEMPO_PADDING,N.y),e.pop()}})),a.snapped_inst){e.stroke(200,240,200);var r=a.snapped_inst.target*f.scale+f.viewport;e.line(r,Math.min(a.snapped_inst.origin,a.snapped_inst.inst)*ne.INST_HEIGHT,r,(Math.max(a.snapped_inst.origin,a.snapped_inst.inst)+1)*ne.INST_HEIGHT)}e.pop(),p.pop()})),e.stroke(100,255,100),a.div_index>=1&&Object.keys(a.divs[a.div_index]).forEach((function(t){var n=a.divs[a.div_index][t][0].inst,s=t*f.scale+f.viewport,i=n*ne.INST_HEIGHT;e.line(s,i,s,i+ne.INST_HEIGHT)}));var s=(e.mouseX-f.viewport)/f.scale,i=[parseInt(Math.abs(s/36e5),10)];if(i=i.concat([6e4,1e3].map((function(e){return parseInt(Math.abs(s/e),10).toString().padStart(2,"0")}))).join(":"),i+="."+parseInt(Math.abs(s%1e3),10).toString().padStart(3,"0"),s<0&&(i="-"+i),2===f.mode&&f.selected.meas){var r=f.selected.meas,o=r.offset*f.scale+f.viewport,l=f.selected.inst*ne.INST_HEIGHT;p.push({x:o,y:l});var u,d=Math.abs(fe.tempo[1]-fe.tempo[0]),g=(r.end-r.start)/r.timesig,E=g/d*ne.INST_HEIGHT,b=(r.start-fe.tempo[0])/d*ne.INST_HEIGHT;if("tempo"===p.drag.mode&&"temp"in r)u=[r.temp.beats[p.drag.index]*f.scale,p.loc.y,10,10],p.cursor="ns-resize";else if("tick"!==p.drag.mode)for(var v=0;v<r.beats.length;v++){var I=r.beats[v]*f.scale,P=ne.INST_HEIGHT-b-E*v;if(p.rolloverCheck([I,P],{type:"tempo",tempo:g*v+r.start})){u=[I,P,10,10];break}}f.drawEditorFrame([o,l],u),p.pop()}p.pop(),T.push("location: ".concat(i)),T.write({x:0,y:(n.length+1)*ne.INST_HEIGHT+ne.DEBUG_TEXT},ne.DEBUG_TEXT),T.frameRate(),T.clear(),e.stroke(200),e.fill(240),p.push({x:ne.PANES_WIDTH,y:0});var _=e.mouseX-p.loc.x,O=e.mouseY-p.loc.y;e.line(_,0,_,ne.INST_HEIGHT*n.length);var H=function(t){var n="inst"in f.insertMeas?(f.insertMeas.temp_offset+t)*f.scale:_+t*f.scale,s="inst"in f.insertMeas?f.insertMeas.inst*ne.INST_HEIGHT:Math.floor(.01*O)*ne.INST_HEIGHT;e.line(n,s,n,s+ne.INST_HEIGHT)};if(p.pop(),1===f.mode){var y=Math.floor(.01*O);R.pollSelecting()?y<n.length&&y>=0&&(e.rect(_,y*ne.INST_HEIGHT,f.insertMeas.ms*f.scale,ne.INST_HEIGHT),e.stroke(255,0,0),"beats"in f.insertMeas&&f.insertMeas.beats.forEach(H)):"temp_offset"in f.insertMeas&&(e.rect(f.insertMeas.temp_offset*f.scale,f.selected.inst*ne.INST_HEIGHT,f.insertMeas.ms*f.scale,ne.INST_HEIGHT),e.stroke(255,0,0),f.insertMeas.beats.forEach(H))}if(m=R.get("isPlaying"),e.stroke(0),e.fill(0),e.textAlign(e.LEFT,e.TOP),e.textSize(12),m){var N=R.exposeTracking().locator();N>fe.span[1]+1e3&&(m=!1,R.play(m,null));var k=N*f.scale+f.viewport;e.line(k,ne.PLAYBACK_HEIGHT,k,2*ne.INST_HEIGHT+ne.PLAYBACK_HEIGHT)}p.dragCursorUpdate(),document.body.style.cursor=p.cursor,e.pop(),f.drawTabs({locator:R.exposeTracking().locator(),cursor_loc:i,isPlaying:m}),f.drawToolbar(fe),p.updateRollover(),f.panels&&(e.fill(255,0,0,10),e.rect(0,ne.PLAYBACK_HEIGHT+ne.INST_HEIGHT*n.length,e.width,ne.INST_HEIGHT))},e.keyReleased=function(e){return!R.checkFocus()&&h.checkNumRelease(),!1},e.keyPressed=function(s){if(!R.disableKeys()&&(R.checkFocus()||!h.checkNumPress())){var a=h.checkDirection();if(f.selected.meas&&a){if("DOWN"===a){if(f.selected.inst>=n.length-1)return;var i=Y(f.selected.meas,n[f.selected.inst+1].ordered,"offset");f.select({ind:i,inst:Math.min(f.selected.inst+1,n.length-1),meas:n[f.selected.inst+1].ordered[i]})}else if("UP"===a){if(f.selected.inst<=0)return;var r=Y(f.selected.meas,n[f.selected.inst-1].ordered,"offset");f.select({ind:r,inst:Math.max(f.selected.inst-1,0),meas:n[f.selected.inst-1].ordered[r]})}else if("LEFT"===a){var o=Math.max(f.selected.ind-1,0);f.select({ind:o,inst:f.selected.inst,meas:n[f.selected.inst].ordered[o]})}else if("RIGHT"===a){var c=Math.min(f.selected.ind+1,n[f.selected.inst].ordered.length-1);f.select({ind:c,inst:f.selected.inst,meas:n[f.selected.inst].ordered[c]})}}else if(27!==e.keyCode){if(73===e.keyCode)return f.mode=1,void R.updateMode(f.mode);if(86===e.keyCode)return f.mode=2,void R.updateMode(f.mode);if(46!==e.keyCode&&8!==e.keyCode){if(32!==e.keyCode)return e.keyIsDown(le)&&(67===e.keyCode&&f.selected.meas?t=n[f.selected.inst].measures[f.selected.meas]:86===e.keyCode&&t&&R.paste(f.selected.inst,t,(e.mouseX-f.viewport)/f.scale)),!0;1===f.mode?R.preview((e.mouseX-f.viewport)/f.scale):R.play((e.mouseX-f.viewport)/f.scale)}else if(!R.checkFocus()&&f.selected.meas){var l=f.selected;f.selected={inst:-1},R.deleteMeasure(l)}}else 0===f.mode?R.toggleInst(!0):(f.mode=0,R.updateMode(f.mode))}},e.mouseWheel=function(t){t.preventDefault();var n=e.keyIsDown(ce);f.updateView(t,{zoom:n}),n&&R.newScaling(f.scale),R.reportWindow(f.viewport,f.scale)},e.mousePressed=function(t){if(p.updatePress(),!p.outside_origin){var s=Math.floor((e.mouseY-ne.PLAYBACK_HEIGHT)/ne.INST_HEIGHT);if(!(s>=n.length||s<0)){if(R.pollSelecting())return f.insertMeas.temp_offset=R.confirmSelecting(s),void(f.insertMeas.inst=s);p.select(),p.outside_origin||f.selected.meas&&(f.mods.shift?f.mods.ctrl?p.tickMode():p.measureMode():f.mods.ctrl&&p.beatLock(me))}}},e.mouseDragged=function(e){if(""!==p.drag.mode&&0!==p.rollover.beat&&!p.outside_origin&&-1!==f.selected.meas&&f.selected.meas){var t=f.selected.meas.id in me&&me[f.selected.meas.id].beats?U(me[f.selected.meas.id].beats):[],c=f.selected.meas.timesig*f.CONSTANTS.PPQ_tempo,u=Array.from({length:c},(function(e,t){return t})),d=function(e,t,n){return Object.keys(a.divs[n]).reduce((function(s,i,r,o){if(a.divs[n][i][0].inst===t)return s;var c=parseFloat(i,10)-e;return Math.abs(c)<Math.abs(s.gap)?{target:parseFloat(i,10),gap:c,inst:a.divs[n][i][0].inst}:s}),{target:-1,gap:1/0,inst:-1})},m=f.selected.meas;"gaps"in m||(m.gaps=function(e,t){var n=!1;return e.reduce((function(e,s,a){return t&&s.id===t||(e=[].concat(Object(o.a)(e),[[n?n.offset+n.ms:-1/0,s.offset]]),n=s),e}),[]).concat([[n.offset+n.ms,1/0]])}(n[f.selected.inst].ordered,f.selected.meas.id));var h=function(e,t,n,s){var a=!(!s||!("strict"in s))&&s.strict,i=t+n;if(i<=e[0][1])return{start:[-1/0,1/0],end:[e[0][1],e[0][1]-i]};var r=e.slice(-1)[0];return t>r[0]?{start:[r[0],t-r[0]],end:[1/0,1/0]}:e.reduce((function(e,s){if(s[1]-s[0]<n-(a?2*ne.NUDGE_THRESHOLD:0))return e;var r=[s[0],t-s[0]],o=[s[1],s[1]-i];return Math.abs(r[1])<Math.abs(e.start[1])&&(e.start=r),Math.abs(o[1])<Math.abs(e.end[1])&&(e.end=o),e}),{start:[0,1/0],end:[0,1/0],gap:[]})},g=f.CONSTANTS.PPQ/f.CONSTANTS.PPQ_tempo,T=p.drag.grab,E=function(e,t,n,s,a){var i=6e4*n/t,r=0,o=-1,c=s*f.CONSTANTS.PPQ_tempo,l=a*f.CONSTANTS.PPQ_tempo,d=i*u.reduce((function(t,n,s){return s===c&&(r=t*i),s===l&&(o=t*i),t+function(e,t){return function(n){return 1/(e*f.CONSTANTS.PPQ_tempo*t/6e4+n)}}(e,i)(s)}),0);return o<0&&(o=d),[d,r,o]},b=function(e,n,s,a,i,r){console.log("spawning nudge"),console.log({oldSlope:n,target:s,_snapper:a,anchor:i,locks:r});var o,c=e.temp.start||e.start,l=e.end,u=e.temp.offset||e.offset,d=n,m=2&r||4&r?.5:1,f=!!(4&r),p=!!(16&r);return function n(r,h,g){if(g>99||Math.abs(r)<ne.NUDGE_THRESHOLD)return{start:c,slope:d,offset:u,ms:o};var T,b;f?(c*=r>ne.NUDGE_THRESHOLD?1+h:1-h,d=l-c):p?c*=r>ne.NUDGE_THRESHOLD?1+h:1-h:d*=r>ne.NUDGE_THRESHOLD?1+h*m:1-h*m;var v=E(c,d,e.timesig,i,a),I=Object(te.a)(v,3);o=I[0],T=I[1],b=I[2],console.log(o,T,b),T&&(u=e.offset+e.beats[t[0]]-T);var P=b+u-s;return n(P,h=function(e,t,n){var s=Math.abs(e)-Math.abs(t),a=Math.abs(s)/Math.abs(e);return s<0&&(n*=-1),n*(1-a)/a}(r,P,h),g+1)}};if("tempo"!==p.drag.mode){if(p.drag.x+=e.movementX,!(Math.abs(p.drag.x)<ne.DRAG_THRESHOLD_X))if("measure"!==p.drag.mode){var v,I=-p.drag.x*f.scale,P=m.end-m.start,_=I/(Math.abs(P)<ne.FLAT_THRESHOLD?1===f.selected.dir?-ne.FLAT_THRESHOLD:ne.FLAT_THRESHOLD:p.grabbed/Math.abs(P));2&s?(P+=_,v=m.start):4&s?(P-=_,v=m.start+_):16&s?v=m.start+_:(P+=_/2,v=m.start+_/2),console.log("from regular calc:",T);var O=E(v,P,m.beats.length-1,t[0],T),H=Object(te.a)(O,3),y=H[0],N=H[1],k=H[2];if(Math.abs(y-m.ms)<ne.DRAG_THRESHOLD_X)return m.temp.offset=m.offset,m.temp.start=m.start,void(P=m.end-m.start);var A=N?m.offset+m.beats[t[0]]-N:m.offset,S=k+A,w=h(m.gaps,A,y);if(!(w.start[1]<0||w.end[1]<0)){var x=d(S,f.selected.inst,a.div_index).target,D=S-x;if(Math.abs(D)<ne.SNAP_THRESHOLD){if(!i){m.temp.start=v,console.log({snapper:T});var G=b(m,P,x,T,t[0],s);i=G(D,.001,0),Object.assign(m.temp,i)}Object.assign(m.temp,i)}else i=!1,m.temp.start=v,m.temp.slope=P;if(8&s){if(!f.selected.dir)return;m.temp.slope*f.selected.dir<2&&(m.temp.slope=0,4&s?m.temp.start=m.end:2&s&&(m.temp.end=m.start))}var M=m.temp.slope/m.ticks.length,j=0,C=6e4/f.CONSTANTS.PPQ,L=0,Q=[],W=[];m.ticks.forEach((function(e,t){t%f.CONSTANTS.PPQ||Q.push(j),W.push(j),t%g===0&&(L=C/(m.temp.start+M*t)),j+=L})),Q.push(j),m.temp.end=m.temp.start+m.temp.slope,m.temp.ms=j,m.temp.offset=m.offset,1===t.length&&(m.temp.offset+=m.beats[t[0]]-Q[t[0]]),Object.assign(fe,{temprange:[Math.min(m.temp.start,fe.tempo[0]),Math.max(m.temp.end,fe.tempo[1])]}),m.temp.ticks=W,m.temp.beats=Q}}else{var F=m.offset+p.drag.x/f.scale,B=function(e,t){return t.reduce((function(t,n,s){var i,r,o,c=d(e+n,f.selected.inst,a.div_index);return i=c.target,r=c.gap,o=c.inst,Math.abs(r)<Math.abs(t.gap)?{index:s,target:i,gap:r,inst:o}:t}),{index:-1,target:1/0,gap:1/0,inst:-1})}(F,m.beats),K=h(m.gaps,F,m.ms),Y={ticks:m.ticks.slice(0),beats:m.beats.slice(0),offset:F};if(Math.abs(K.start[1])<Math.abs(K.end[1])?K.start[1]-2*ne.SNAP_THRESHOLD<0&&(Y.offset=K.start[0]):K.end[1]-2*ne.SNAP_THRESHOLD<0&&(Y.offset=K.end[0]-m.ms),-1!==B.index){var z=B.target-(m.beats[B.index]+F);Math.abs(z)<50?(a.snapped_inst=Object(l.a)(Object(l.a)({},B),{},{origin:f.selected.inst}),Y.offset=F+z):a.snapped_inst={}}Object.assign(m.temp,Y)}}else{p.drag.y+=e.movementY,console.log(f.selected.meas.temp);var V=fe.tempo[1]-fe.tempo[0],X=p.drag.y/ne.INST_HEIGHT*V,Z=t.length?t[0]:0,J=(m.end-m.start)/m.timesig*Z;if(Z!==p.grabbed){var q=(m.end-m.start)/m.timesig*p.grabbed-X;if(!t.length){var $={start:m.start-X,end:m.end-X,offset:m.offset,beats:[],ticks:[]};if($.start<10||$.end<10)return;r||(r=h(m.gaps,m.offset,m.ms,{strict:!0}));var ee=r;$.slope=$.end-$.start;var se=(m.end-m.start)/m.ticks.length,ae=0,ie=6e4/f.CONSTANTS.PPQ,re=0;if(m.ticks.forEach((function(e,t){t%f.CONSTANTS.PPQ||$.beats.push(ae),$.ticks.push(ae),t%g===0&&(re=ie/($.start+se*t)),ae+=re})),$.beats.push(ae),$.offset+=(m.ms-ae)/2,$.offset<ee.start[0]+ne.SNAP_THRESHOLD?$.offset=ee.start[0]:$.offset+ae>ee.end[0]-ne.SNAP_THRESHOLD&&($.offset=ee.end[0]-ae),Object.assign($,{cumulative:ae}),ae>ee.end[0]-ee.start[0]){if(console.log("jump"),$.offset=ee.start[0],!i){m.temp.offset=$.offset;var oe=b(m,$.slope,ee.end[0],m.timesig,0,16);i=oe(ee.end[0]-(ee.start[0]+ae),.01,0)}$.start=i.start,$.end=i.start+$.slope,$.beats=[],$.ticks=[],ae=0,m.ticks.forEach((function(e,t){t%f.CONSTANTS.PPQ||$.beats.push(ae),$.ticks.push(ae),t%g===0&&(re=ie/(i.start+se*t)),ae+=re})),$.beats.push(ae),Object.assign($,{cumulative:ae})}else i=!1;var ce=[Math.min($.start,fe.tempo[0]),Math.max($.end,fe.tempo[1])];return Object.assign(fe,{temprange:ce}),void Object.assign(m.temp,$)}var le=(q-J)/(p.grabbed-Z),ue=q+m.start-le*p.grabbed,de=le/f.CONSTANTS.PPQ,pe=0,he=6e4/f.CONSTANTS.PPQ,ge=0,Te=[],Ee=[];m.ticks.forEach((function(e,t){t%f.CONSTANTS.PPQ||Te.push(pe),Ee.push(pe),t%g===0&&(ge=he/(ue+de*t)),pe+=ge})),Te.push(pe);var be=m.offset+m.beats[Z]-Te[Z],ve=h(m.gaps,be,pe),Ie={start:ue,slope:le*m.timesig,offset:be};if(m.offset>ve.start[0]+ne.NUDGE_THRESHOLD&&ve.start[1]<ne.SNAP_THRESHOLD){if(console.log("Path 1"),!i){m.temp.start=ue;var Pe=b(m,le*m.timesig,ve.start[0],0,t[0],s);i=Pe(ve.start[1],.01,0)}Object.assign(Ie,i)}else if(m.offset+m.ms<ve.end[0]-ne.NUDGE_THRESHOLD&&ve.end[1]<ne.SNAP_THRESHOLD){if(console.log("Path 2"),!i){m.temp.start=ue;var _e=b(m,le*m.timesig,ve.end[0],m.timesig,t[0],s);i=_e(ve.end[1],.001,0)}Object.assign(Ie,i)}else i=!1;i&&Object.assign(Ie,i),Te=[],Ee=[],pe=0,ge=0,de=Ie.slope/(f.CONSTANTS.PPQ*m.timesig),m.ticks.forEach((function(e,t){t%f.CONSTANTS.PPQ||Te.push(pe),Ee.push(pe),t%g===0&&(ge=he/(Ie.start+de*t)),pe+=ge})),Te.push(pe),Ie.end=Ie.start+Ie.slope,Ie.ticks=Ee,Ie.beats=Te,Ie.ms=pe,Z&&(Ie.offset=m.offset+m.beats[Z]-Te[Z]);var Oe=[Math.min(Ie.start,fe.tempo[0]),Math.max(Ie.end,fe.tempo[1])];Object.assign(fe,{temprange:Oe}),Object.assign(m.temp,Ie)}R.updateEdit(m.temp.start,m.temp.end,m.timesig,m.temp.offset)}}},e.mouseReleased=function(t){if(p.outside_origin)p.drag.mode="";else if(i=!1,r=!1,e.mouseY<0||e.mouseY>e.height)p.drag.mode="";else{if(Math.abs(p.drag.x)<ne.DRAG_THRESHOLD_X&&Math.abs(p.drag.y)<ne.DRAG_THRESHOLD_X)return f.selected.meas&&delete f.selected.meas.temp,void Object.assign(p.drag,{x:0,y:0,mode:""});if(f.selected.meas){var n=f.selected.meas;if(fe.tempo=fe.temprange,delete fe.temprange,"tempo"===p.drag.mode)return R.updateMeasure(f.selected.inst,f.selected.meas.id,n.temp.start,n.temp.end,n.beats.length-1,n.temp.offset),console.log(n.temp),delete f.selected.meas.temp,void Object.assign(p.drag,{x:0,y:0,mode:""});if("measure"===p.drag.mode)return R.updateMeasure(f.selected.inst,f.selected.meas.id,n.start,n.end,n.beats.length-1,n.temp.offset),void Object.assign(p.drag,{x:0,y:0,mode:""});if("tick"===p.drag.mode){var s=n.temp.start+n.temp.slope;if(n.temp.ticks=[],Object.assign(p.drag,{x:0,y:0,mode:""}),s<10)return;R.updateMeasure(f.selected.inst,f.selected.meas.id,n.temp.start,s,n.beats.length-1,n.temp.offset)}}else p.drag.mode=""}},e.mouseMoved=function(t){return R.newCursor((e.mouseX-f.viewport)/f.scale),!1}}function he(){var e=Object(J.a)(["\n    div {\n        padding-left: ","px;\n        z-index: -100;\n    }\n"]);return he=function(){return e},e}var ge=q.a.div(he(),ne.CANVAS_PADDING),Te=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){var n=this;if(e.mode!==this.props.mode||e.panels!==this.props.panels||!g.a.isEqual(e.insertMeas,this.props.insertMeas)||!g.a.isEqual(e.editMeas,this.props.editMeas)||e.locks.length!==this.props.locks.length||e.instruments.length!==this.props.instruments.length||e.CONSTANTS.PPQ!==this.props.CONSTANTS.PPQ)return!0;var s=!1;return e.instruments.forEach((function(e,t){Object.keys(e.measures).length!==Object.keys(n.props.instruments[t].measures).length&&(s=!0),Object.keys(e.measures).forEach((function(a){a in n.props.instruments[t].measures?["start","end","offset"].forEach((function(i){e.measures[a][i]!==n.props.instruments[t].measures[a][i]&&(s=!0)})):s=!0}))})),s}},{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement(ge,null,a.a.createElement(ee.a,{key:1,className:"p5",sketch:pe,instruments:this.props.instruments,editMeas:this.props.editMeas,insertMeas:this.props.insertMeas,panels:this.props.panels,mode:this.props.mode,locks:this.props.locks,API:this.props.API,CONSTANTS:this.props.CONSTANTS})))}}]),n}(s.Component),Ee=n(154);function be(){var e=Object(J.a)(["\n    &.toggle-dropdown {\n        background-color: red;\n    }\n    color: red;\n    padding: 5px 6px;\n    border: none;\n    border-radius: 0px;\n    background-color: ",";\n    text-align: center;    \n    width: 100%;\n"]);return be=function(){return e},e}function ve(){var e=Object(J.a)(["\n    height: 40px;\n    &.dropdown-toggle {\n        ","\n    }\n\n    &.btn.btn-primary.dropdown-toggle {\n        ","\n        color: ",";\n        background-color: ",";\n        ","\n    };\n\n    &.btn.btn-primary.dropdown-toggle:focus {\n        ","\n        color: ",";\n        background-color: ",";\n        ","\n    };\n\n    &.btn.btn-primary.dropdown-toggle:hover {\n        ","\n    };\n\n    &.btn.btn-primary.dropdown-toggle:active {\n        ","\n        color: ",";\n        background-color: ",";\n        ","\n    };\n"]);return ve=function(){return e},e}function Ie(){var e=Object(J.a)(["\n    width: ","px;\n    height: ","px;\n    ","\n    border: none;\n    border-left: 1px solid ",";\n    color: ",";\n    background-color: ",";\n    text-align: center;    \n    &:focus {\n        outline: none;\n    }\n"]);return Ie=function(){return e},e}function Pe(){var e=Object(J.a)(["\n    \n    padding: 0px 4px;\n    font-size: 10px;\n    float: right;\n    margin: ","px;\n    &:focus {\n        outline: none;\n    }\n"]);return Pe=function(){return e},e}function _e(){var e=Object(J.a)(["\n    height: 40px;\n    padding-left: 10px;\n    &:focus {\n        outline: none;\n    }\n"]);return _e=function(){return e},e}function Oe(){var e=Object(J.a)(["\n    ","\n    ","\n    &:hover {\n        ","\n    }\n    padding: 0px;\n"]);return Oe=function(){return e},e}function He(){var e=Object(J.a)(["\n    color: ",";\n"]);return He=function(){return e},e}function ye(){var e=Object(J.a)(["\n    ","\n    padding: 2px 4px;\n    color: ",";\n    background-color: ",";\n"]);return ye=function(){return e},e}function Ne(){var e=Object(J.a)(["\n    color: red;\n    font-weight: bold;\n"]);return Ne=function(){return e},e}function ke(){var e=Object(J.a)(["\n    position: absolute;\n    top: ","px;\n    left: ","px;\n    width: ","px;\n    input {\n        margin: 0px 6px;\n        width: 28px;\n        background-color: initial;\n    }\n    z-index: 50;\n"]);return ke=function(){return e},e}function Ae(){var e=Object(J.a)(["\n    position: absolute;\n    bottom: ","px;\n    left: ","px;\n    z-index: 50;\n\n    button {\n        ","\n        ","\n        width: 18px;\n    }\n"]);return Ae=function(){return e},e}function Se(){var e=Object(J.a)(["\n    position: absolute;\n    height: ","px;\n    width: ","px;\n    ","\n    ","\n    bottom: ","px;\n    \n    z-index: 50;\n"]);return Se=function(){return e},e}function we(){var e=Object(J.a)(["\n    text-decoration: none;\n    margin: 5px;\n    color: red;\n    display: inline-block;\n"]);return we=function(){return e},e}function xe(){var e=Object(J.a)(["\n    position: absolute;\n    &.btn-group.btn {\n        position: fixed;\n    }\n    margin: 0px;\n    left: ","px;\n    top: ","px;\n    width: ","px;\n    &:hover {\n        width: ","px;\n    }\n    padding: 0px;\n    height: ","px;\n    border: none;\n    border-radius: 0px;\n    background-color: #FFFFCC;\n"]);return xe=function(){return e},e}function De(){var e=Object(J.a)(["\n    ","\n    .flavor {\n        font-size: 48pt;\n    }\n    padding-left: ","px;\n"]);return De=function(){return e},e}function Ge(){var e=Object(J.a)(["\n    height: ","px;\n"]);return Ge=function(){return e},e}function Me(){var e=Object(J.a)(["\n    height: ","px;\n"]);return Me=function(){return e},e}function Re(){var e=Object(J.a)(["\n    height: ","px;\n"]);return Re=function(){return e},e}function je(){var e=Object(J.a)(["\n    padding: 10px;\n    background-color: ",";\n    width: ","px;\n    border: black solid 1px;\n    color: red;\n"]);return je=function(){return e},e}function Ce(){var e=Object(J.a)(["\n    width: initial;\n    background-color: none;\n    font-size: 10pt;\n    color: ",";\n"]);return Ce=function(){return e},e}function Le(){var e=Object(J.a)(["\n    position: absolute;\n    width: ","px;\n    left: ","px;\n    top: ","px;\n    height: ","px;\n    border: none;\n    z-index: 50;\n\n    button {\n        color: ",";\n        background-color: initial;\n        border: 0;\n    }\n\n    .closed {\n        ","\n        position: absolute;\n        left: 0px;\n    }\n\n    .opened {\n        ","\n        position: absolute;\n        left: 75px;\n        transform: rotate(45deg);\n    }\n        \n        \n"]);return Le=function(){return e},e}function Qe(){var e=Object(J.a)(["\n    position: absolute;\n    background-color: ",";\n    text-align: center;    \n    width: 100%;\n    padding: 0px;\n"]);return Qe=function(){return e},e}function We(){var e=Object(J.a)(["\n    width: 50px;\n    z-index: 50;\n    height: ",";\n    position: absolute;\n    left: ","\n    top: ","\n    padding-top: 0px;\n    padding-bottom: 0px;\n"]);return We=function(){return e},e}var Fe="\n    @import url('https://fonts.googleapis.com/css2?family=Work+Sans:wght@500&display=swap');\n    font-family: 'Work Sans', sans-serif;\n",Be="\n    ".concat(Fe,"\n    background-color: ").concat(ne.secondary,";\n    border: none;\n    box-shadow: none;\n    color: ").concat(ne.primary,";\n    text-align: center;    \n    &:hover {\n        text-shadow: 1px 1px 5px ").concat(ne.primary_shadow,";\n    }\n"),Ke=["transition","-webkit-transition","-moz-transition","-ms-transition","-o-transition"].reduce((function(e,t){return"".concat(e).concat(t,": ").concat("0.3s",";\n")}),""),Ye=q.a.button(We(),ne.PLAYBACK_HEIGHT+"px",(function(e){return e.x+"px"}),(function(e){return e.y+"px"})),Ue=q.a.div(Qe(),ne.secondary),ze=q.a.div(Le(),ne.PANES_WIDTH,(function(e){return e.x}),(function(e){return e.y}),(function(e){return e.height}),ne.primary,Ke,Ke),Ve=Object(q.a)(ze)(Ce(),ne.secondary),Xe=Object(q.a)(ze)(je(),ne.secondary,ne.TOOLBAR_WIDTH),Ze=(Object(q.a)(Xe)(Re(),ne.META_HEIGHT),Object(q.a)(Xe)(Me(),ne.REHEARSAL_HEIGHT),Object(q.a)(Xe)(Ge(),ne.LOG_HEIGHT),q.a.div(De(),Fe,ne.FOOTER_PADDING)),Je=q.a.button(xe(),(function(e){return e.x}),(function(e){return e.y}),ne.PANES_WIDTH,ne.PANES_WIDTH+20,ne.TRACK_HEIGHT/3),qe=q.a.a(we()),$e=[Fe,"border: none;\n    border-bottom: solid 1px ".concat(ne.secondary,";\n    width: 48px;\n    padding: 2px;\n    margin: 4px;\n    font-size: 8pt;\n\n    &:focus {\n        outline: none;\n        border: none;\n        border-bottom: solid 1px ").concat(ne.secondary,";\n    }\n\n")].join("\n"),et=q.a.div(Se(),ne.TRACKING_HEIGHT,ne.EDITOR_WIDTH,(function(e){return e.left?"left: ".concat(e.left,"px;"):null}),(function(e){return e.right?"right: ".concat(e.right,"px;"):null}),ne.FOOTER_HEIGHT),tt=q.a.div(Ae(),ne.FOOTER_HEIGHT+ne.TRACKING_HEIGHT,(function(e){return e.left}),Be,$e),nt=q.a.div(ke(),(function(e){return e.top}),(function(e){return e.left}),(function(e){return e.width})),st=(Object(q.a)((function(e){var t=e.className,n=e.children;return a.a.createElement("button",{className:t},n)}))(Ne()),q.a.input(ye(),$e,ne.secondary,ne.primary)),at=(q.a.h3(He(),ne.primary),q.a.button(Oe(),Be,Ke,Ke)),it=Object(q.a)(at)(_e()),rt=Object(q.a)(at)(Pe(),2),ot=function(e){return["-webkit-transition","-moz-transition","-ms-transition","-o-transition"].reduce((function(t,n){return"".concat(t).concat(n,"-property: ").concat(e,";\n")}),"")},ct=q.a.button(Ie(),ne.LOCK_HEIGHT,ne.LOCK_HEIGHT,ot("none"),(function(e){return e.checked?ne.primary:ne.secondary}),(function(e){return e.checked?ne.primary:ne.secondary}),(function(e){return e.checked?ne.secondary:"initial"})),lt=q.a.div(ve(),Be,Be,ne.primary,ne.secondary,ot("none"),Be,ne.secondary,ne.primary,ot("none"),ot("none"),Be,ne.secondary,ne.primary,ot("none")),ut=Object(q.a)((function(e){return a.a.createElement(Ee.a,{onSelect:e.onSelect},a.a.createElement(lt,null,e.toggle),a.a.createElement(Ee.a.Menu,null,e.menuItems.map((function(e){return a.a.createElement(Ee.a.Item,{key:e.eventKey,eventKey:e.eventKey},e.text)}))))}))(be(),ne.secondary),dt=n(153),mt=n(150),ft=n(151),pt=n(152);function ht(){var e=Object(J.a)(["\n    border: none;\n    color: red;\n"]);return ht=function(){return e},e}var gt=Object(q.a)(dt.a.Body)(ht()),Tt=function(e){return a.a.createElement(at,{onClick:e.onClick},e.children)},Et=function(e){return a.a.createElement(dt.a,{show:e.show,size:"sm",onHide:e.onHide,centered:!0},a.a.createElement(dt.a.Header,{closeButton:!0},e.body),a.a.createElement(dt.a.Dialog,{style:{height:"100px"},centered:!0},a.a.createElement(gt,null,e.buttons.map((function(e,t){return a.a.createElement(Tt,{key:t,onClick:e.onClick},e.text)})))))},bt=function(e){var t=ne.PPQ_OPTIONS.map((function(e,t){return{eventKey:t,text:"".concat(e[0]," (").concat(e[1],")")}})),n=[{name:"Tempo PPQ",body:a.a.createElement(ut,{onSelect:e.onTempoSelect,toggle:e.settings.PPQ_tempo+" ("+e.settings.PPQ_desc+")",menuItems:t})},{name:"PPQ",body:a.a.createElement(ut,{className:"shadow-none",onSelect:e.onPPQSelect,toggle:e.settings.PPQ,menuItems:[{eventKey:256,text:256},{eventKey:96,text:96},{eventKey:24,text:24}]})}].map((function(e,t){return a.a.createElement("div",{key:t},a.a.createElement(mt.a,null,a.a.createElement(ft.a,{xs:4},a.a.createElement("span",null,e.name)),a.a.createElement(ft.a,{xs:8},e.body)))}));return a.a.createElement(dt.a,{show:e.show,size:"lg",style:{width:"100%"},onHide:e.onHideCallback,centered:!0},a.a.createElement(dt.a.Header,{closeButton:!0},"Preferences"),a.a.createElement(dt.a.Dialog,{style:{height:"100px"},centered:!0},a.a.createElement(gt,null,a.a.createElement(pt.a,null,n))))},vt=n(86),It=n.n(vt)()("http://localhost:3001");It.on("hello",(function(e){It.emit("frame",1),It.emit("loopback","stfu")}));var Pt=ne.PPQ_OPTIONS.map((function(e){return{PPQ_tempo:e[0],PPQ_desc:e[1]}})),_t=function(e){var t=[],n=[];return Object.keys(e).forEach((function(s){t.push(e[s].start),t.push(e[s].end),n.push(e[s].offset),n.push(e[s].offset+e[s].ms)})),{tempo:[Math.min.apply(Math,t),Math.max.apply(Math,t)],span:[Math.min.apply(Math,n),Math.max.apply(Math,n)]}},Ot=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e,s){var i,r;Object(u.a)(this,n),(r=t.call(this,e,s)).state={instruments:[],ordered:{},sizing:600,cursor:0,start:"",end:"",timesig:"",edit_start:"",edit_end:"",edit_timesig:"",offset:"",instName:"",temp_offset:"",scale:1,viewport:0,time:0,selected:{},isPlaying:!1,isPreviewing:!1,keysDisabled:!1,previewMeasure:{},insertMeas:{},editMeas:{},insertInst:-1,tracking:0,locks:[],mode:0,newInst:!1,PPQ:ne.PPQ_default},["insertFocusStart","insertFocusEnd","insertFocusTimesig","instNameFocus"].forEach((function(e){return r[e]=a.a.createRef()})),Object.assign(r.state,Pt[1]),C.subscribe((function(e){return r.setState((function(t){return{tracking:e.tracking}}))})),C.schedulerHook((function(e){})),C.triggerHook((function(e){It.emit("schedule",e.reduce((function(e,t){return e|1<<t}),0))})),r.state.PPQ_mod=r.state.PPQ/r.state.PPQ_tempo;var o=[E()(),E()(),E()(),E()(),E()()];return r.state.instruments.push({name:"default",measures:(i={},Object(c.a)(i,o[0],Object(l.a)(Object(l.a)({},B({start:60,end:120,timesig:5,offset:12e3},{PPQ:r.state.PPQ,PPQ_tempo:r.state.PPQ_tempo})),{},{id:o[0],inst:r.state.instruments.length})),Object(c.a)(i,o[1],Object(l.a)(Object(l.a)({},B({start:60,end:120,timesig:6,offset:500},{PPQ:r.state.PPQ,PPQ_tempo:r.state.PPQ_tempo})),{},{id:o[1],inst:r.state.instruments.length})),Object(c.a)(i,o[2],Object(l.a)(Object(l.a)({},B({start:60,end:120,timesig:5,offset:4722},{PPQ:r.state.PPQ,PPQ_tempo:r.state.PPQ_tempo})),{},{id:o[2],inst:r.state.instruments.length})),i)}),r.state.instruments.push({name:"asdf",measures:Object(c.a)({},o[3],Object(l.a)(Object(l.a)({},B({start:60,end:120,timesig:5,offset:12e3},{PPQ:r.state.PPQ,PPQ_tempo:r.state.PPQ_tempo})),{},{id:o[3],inst:r.state.instruments.length}))}),r.sizing=600,r.location=0,r.handleMeasure=r.handleMeasure.bind(Object(m.a)(r)),r.handleInst=r.handleInst.bind(Object(m.a)(r)),r.instOpen=r.instOpen.bind(Object(m.a)(r)),r.instClose=r.instClose.bind(Object(m.a)(r)),r.handleLock=r.handleLock.bind(Object(m.a)(r)),r.handleNumInput=r.handleNumInput.bind(Object(m.a)(r)),r.handleNumEdit=r.handleNumEdit.bind(Object(m.a)(r)),r.handleNameInput=r.handleNameInput.bind(Object(m.a)(r)),r.handleOffset=r.handleOffset.bind(Object(m.a)(r)),r.handlePPQ=r.handlePPQ.bind(Object(m.a)(r)),r.handleTempoPPQ=r.handleTempoPPQ.bind(Object(m.a)(r)),r.midi=r.midi.bind(Object(m.a)(r)),r.play=r.play.bind(Object(m.a)(r)),r.preview=r.preview.bind(Object(m.a)(r)),r.kill=r.kill.bind(Object(m.a)(r)),r.save=r.save.bind(Object(m.a)(r)),r.load=r.load.bind(Object(m.a)(r)),r.upload=r.upload.bind(Object(m.a)(r)),r.reset=r.reset.bind(Object(m.a)(r)),r.settings=r.settings.bind(Object(m.a)(r)),r.handleNew=r.handleNew.bind(Object(m.a)(r)),r.handleOpen=r.handleOpen.bind(Object(m.a)(r)),r.confirmEdit=r.confirmEdit.bind(Object(m.a)(r)),r.inputs={},r.API=r.initAPI(),r}return Object(d.a)(n,[{key:"initAPI",value:function(){var e=this,t=this;return{toggleInst:function(t){return t?e.instClose():e.instOpen()},pollSelecting:function(){return!!e.state.temp_offset},confirmSelecting:function(t){return e.setState({offset:e.state.cursor,temp_offset:!1,insertInst:t}),e.state.cursor},get:function(e){if("isPlaying"===e)return t.state.isPlaying},deleteMeasure:function(e){return t.setState((function(t){Z.a.log("Deleting measure ".concat(e.meas.id," from instrument ").concat(e.inst,"."));var n=t.ordered;if(Object.keys(n)){var s=t.instruments[e.inst].measures[e.meas.id];s.beats.forEach((function(t,a){V.a.tree.edit(n,{_clear:t+s.offset,inst:e.inst})}))}return delete t.instruments[e.inst].measures[e.meas.id],{instruments:t.instruments,selected:{},ordered:n}}))},updateMeasure:function(n,s,a,i,r,o){Z.a.log("Updating measure ".concat(s," in instrument ").concat(n,"."));var c=e.state.instruments[n].measures[s].offset,u=B({start:a,end:i,timesig:r,offset:o=o||c},{PPQ:e.state.PPQ,PPQ_tempo:e.state.PPQ_tempo});t.setState((function(e){var t=e.instruments,a=t[n].measures[s],i=Object(l.a)(Object(l.a)({},u),{},{id:s,inst:n,beat_nodes:[]}),r=Object.assign(e.ordered,{});return Object.keys(r)&&u.beats.forEach((function(e,t){return V.a.tree.edit(r,{inst:n,newMeas:i,_clear:a.beats[t]+a.offset,_target:e+o})})),t[n].measures[s]=i,{instruments:t,ordered:r}}))},newScaling:function(e){return t.setState((function(t){return{sizing:600/e}}))},newCursor:function(e){return t.setState((function(t){return{cursor:e}}))},displaySelected:function(e){t.setState((function(t){return{selected:e,editMeas:{},edit_start:e.meas.start,edit_end:e.meas.end,edit_timesig:e.meas.timesig}}))},paste:function(n,s,a){Z.a.log("Pasting copied measure ".concat(s.id," into instrument ").concat(n,"..."));var i=B({start:s.start,end:s.end,timesig:s.beats.length-1,offset:a},{PPQ:e.state.PPQ,PPQ_tempo:e.state.PPQ_tempo});t.setState((function(e){var t=e.instruments,s=E()();return t[n].measures[s]=Object(l.a)(Object(l.a)({},i),{},{id:s,inst:n}),Z.a.log("New measure ".concat(s," created in instrument ").concat(n,".")),{instruments:t}}))},play:function(t){Z.a.log("Starting playback at ".concat(t,"ms.")),e.play(!e.state.isPlaying,t||0)},preview:function(t){e.preview(!e.state.isPreviewing)},exposeTracking:function(){return{context:C.context,locator:C.locator}},updateMode:function(t,n){Z.a.log("Entering mode ".concat(t,"."));var s={mode:t};1===t?(e.setState(s),e.insertFocusStart.current.focus()):(s.insertMeas={},2===t||(["start","end","timesig","offset"].forEach((function(e){s[e]="",s["edit_".concat(e)]=""})),s.temp_offset=!1,s.editMeas={}),e.setState(s))},reportWindow:function(t,n){return e.setState({viewport:t,scale:n})},disableKeys:function(){return e.state.keysDisabled},updateEdit:function(t,n,s,a){return e.setState({edit_start:t,edit_end:n,edit_timesig:s})},checkFocus:function(){return[e.insertFocusStart,e.insertFocusEnd,e.insertFocusTimesig].reduce((function(e,t){return document.activeElement&&t.current?e||t.current.id===document.activeElement.id:e}),!1)}}}},{key:"instOpen",value:function(e){var t=this;this.setState((function(){return{newInst:!0}}),(function(){return t.instNameFocus.current.focus()}))}},{key:"instClose",value:function(e){this.setState({newInst:!1})}},{key:"handleInst",value:function(e){e.preventDefault();var t={name:this.state.instName,measures:{}};this.setState((function(e){var n=e.selected.inst,s=-1===n?e.instruments.length:n;return e.instruments.splice(s+1,0,t),e.newInst=!1,Z.a.log("Adding new instrument in slot ".concat(s,".")),e}))}},{key:"handleMeasure",value:function(e){e.preventDefault();var t=this.state.insertInst||this.state.selected.inst,n=this.state.selected.meas,s={start:parseInt(this.state.start,10),end:parseInt(this.state.end,10),timesig:parseInt(this.state.timesig,10),offset:this.state.offset?parseInt(this.state.offset,10):n.ms+n.offset},a=B(s,{PPQ:this.state.PPQ,PPQ_tempo:this.state.PPQ_tempo});this.setState((function(e){var n=e.instruments,s=E()();n[t].measures[s]=Object(l.a)(Object(l.a)({},a),{},{id:s,inst:t});return{instruments:n,mode:0,start:"",end:"",timesig:"",offset:"",temp_offset:!1}}))}},{key:"handleLock",value:function(e,t){var n=this.state.locks.indexOf(e);this.setState((function(t){var s=Object(o.a)(t.locks);return n>=0?s.splice(n,1):s.push(e),{locks:s}}))}},{key:"handleMuting",value:function(e,t,n){e.indexOf("mute")>-1?C.mute(n,!0):C.mute(n,!1),e.indexOf("solo")>-1&&this.state.instruments.forEach((function(e,t){return C.mute(t,t!==n)}))}},{key:"handleNumInput",value:function(e){if(""===e.target.value)this.setState(Object(c.a)({},e.target.name,""));else if(/^[0-9\b]+$/.test(e.target.value)){var t,n=parseInt(e.target.value,10),s=this.state.selected.meas?this.state.selected.meas.ms:0,a={start:this.state.start,end:this.state.end,timesig:this.state.timesig,offset:this.state.offset||s};Object.assign(a,Object(c.a)({},e.target.name,n));var i=["start","end","timesig"].reduce((function(e,t){return e&&a[t]}),!0)?B(a,{PPQ:this.state.PPQ,PPQ_tempo:this.state.PPQ_tempo}):{};this.setState((t={},Object(c.a)(t,e.target.name,n),Object(c.a)(t,"insertMeas",i),t))}}},{key:"handleNumEdit",value:function(e){if(""===e.target.value)this.setState(Object(c.a)({},"edit_".concat(e.target.name),""));else if(/^[0-9\b]+$/.test(e.target.value)){var t=parseInt(e.target.value,10),n=Object(c.a)({},"edit_".concat(e.target.name),t),s=2;if("timesig"===e.target.name&&(s=1),e.target.value.length<s);else{var a={start:this.state.edit_start||this.state.selected.meas.start,end:this.state.edit_end||this.state.selected.meas.end,timesig:this.state.edit_timesig||this.state.selected.meas.timesig,offset:this.state.edit_offset||this.state.selected.meas.offset};Object.assign(a,Object(c.a)({},e.target.name,t)),n.editMeas=["start","end","timesig"].reduce((function(e,t){return e&&a[t]}),!0)?B(a,{PPQ:this.state.PPQ,PPQ_tempo:this.state.PPQ_tempo}):{}}this.setState(n)}}},{key:"confirmEdit",value:function(e){e.preventDefault(),this.setState((function(e){var t=e.instruments,n=e.selected.meas.id;return t[e.selected.inst].measures[n]=Object(l.a)(Object(l.a)({},e.editMeas),{},{id:n}),{instruments:t,editMeas:{}}}))}},{key:"handleNameInput",value:function(e){this.setState(Object(c.a)({},e.target.name,e.target.value))}},{key:"handleOffset",value:function(e,t){this.setState({temp_offset:e})}},{key:"handleTempoPPQ",value:function(e){document.activeElement.blur();var t=Pt[e];this.setState((function(e){return t}))}},{key:"handlePPQ",value:function(e,t){document.activeElement.blur(),this.setState((function(t){return{PPQ:e}}))}},{key:"midi",value:function(){var e=this;!function(e,t,n){v.a.Constants.HEADER_CHUNK_DIVISION=[0,t];var s=new P.a,a=s.folder("score"),i=t/n;e.forEach((function(e){var n=[new v.a.Track,new v.a.Track],s=e.tempi.slice(0,1);n[0].setTempo(s[0].tempo);var r=s[0].delta;e.tempi.slice(1).forEach((function(e){n[0].addEvent(new _(r,e.tempo)),"timesig"in e&&n[0].addEvent(new O(e.timesig,4,t)),r="delta"in e?e.delta:i})),e.beats.forEach((function(e){return n[1].addEvent(new v.a.NoteEvent(e))}));var o=new v.a.Writer(n),c=new Blob([o.buildFile()],{type:"audio/midi"});a.file(e.name+".mid",c)}));var r=document.createElement("a");r.download="score.zip",s.generateAsync({type:"blob"}).then((function(e){r.href=window.URL.createObjectURL(e),document.body.appendChild(r),r.click(),document.body.removeChild(r)}),(function(e){return console.log(e)}))}(this.state.instruments.map((function(t,n){var s=0,a=6e4/e.state.PPQ,i="T".concat(e.state.PPQ-1),r=[],o=K(t.measures,"offset").reduce((function(n,o,c){var u=t.measures[o],d=e.state.PPQ-1;if(s)u.offset-(s.offset+s.ms)>ne.DELTA_THRESHOLD&&(d=parseInt(d/(a/s.end),10),n.push({delta:d,tempo:s.end}));else{var m=(d=Math.round(u.offset/(a/300)))/(u.offset/a);n.push({delta:d,tempo:m})}var f="T".concat(d);s=u;var p=(u.end-u.start)/u.ticks.length,h={},g={duration:"T1",pitch:["C4"]},T=[Object(l.a)(Object(l.a)({},h),{},{tempo:u.start,timesig:u.timesig})];return r.push(Object(l.a)(Object(l.a)({},g),{},{wait:f})),u.ticks.forEach((function(t,n){0!==n&&(n%e.state.PPQ_mod||(n%(u.ticks.length/u.timesig)||r.push(Object(l.a)(Object(l.a)({},g),{},{wait:i})),T.push(Object(l.a)(Object(l.a)({},h),{},{tempo:u.start+n*p}))))})),n.concat(T)}),[]);return r.push({duration:"4",pitch:["C4"],wait:i}),o.push({tempo:s.end}),{tempi:o,beats:r,name:t.name}})),this.state.PPQ,this.state.PPQ_tempo)}},{key:"play",value:function(e,t){var n={};if(e)if(g.a.isEqual(this.state.ordered,{})){var s;this.state.instruments.forEach((function(e,t){return Object.keys(e.measures).forEach((function(t){return e.measures[t].beats.forEach((function(n){return s=V.a.tree.insert(n+e.measures[t].offset,e.measures[t],s)}))}))})),C.play(e,s,t),n.ordered=s}else C.play(e,this.state.ordered,t);else C.kill();document.activeElement.blur(),n.isPlaying=e,this.setState((function(e){return n}))}},{key:"preview",value:function(e){var t=this;this.state.previewTimeout&&clearTimeout(this.state.previewTimeout);var n=function(){C.kill(),t.setState({isPreviewing:!1})};if(e){var s=B({start:this.state.start,end:this.state.end,timesig:this.state.timesig,offset:0},{PPQ:this.state.PPQ,PPQ_tempo:this.state.PPQ_tempo});this.setState((function(t){return{previewMeasure:s,isPreviewing:e,previewTimeout:setTimeout(n,s.ms)}})),C.play(e,[[0,s.beats]])}else n()}},{key:"kill",value:function(){C.kill()}},{key:"save",value:function(){var e=this.state.instruments,t=[["inst","start","end","timesig","offset"]];Object.keys(e).forEach((function(n){return Object.keys(e[n].measures).forEach((function(s){return t.push([n].concat(["start","end","timesig","offset"].map((function(t){return e[n].measures[s][t]}))))}))}));var n=document.createElement("a");n.href=encodeURI("data:text/csv;utf-8,".concat(t.join("\n"))),n.download="filename.csv",document.body.appendChild(n),n.click(),document.body.removeChild(n)}},{key:"upload",value:function(e){this.state.instruments.length>1||Object.keys(this.state.instruments[0].measures).length?this.setState({warningOpen:!0}):document.getElementById("dummyLoad").click()}},{key:"handleNew",value:function(e){this.setState({instruments:[{name:"default",measures:{}}],warningNew:!1})}},{key:"handleOpen",value:function(e){document.getElementById("dummyLoad").click(),this.setState({warningOpen:!1})}},{key:"reset",value:function(e){this.setState({warningNew:!0})}},{key:"settings",value:function(e){this.setState((function(e){return{settingsOpen:!e.settingsOpen}}))}},{key:"load",value:function(e){var t=this,n=e.target.files[0].name,s=new FileReader;s.onload=function(e){Z.a.log("Loading file ".concat(n,"..."));var s=-1,a=0,i=e.target.result.split("\n").slice(1).reduce((function(e,n){var i=n.split(",");s=Math.max(s,i[0]),a++;var r=B(["start","end","timesig","offset"].reduce((function(e,t,n){return Object(l.a)(Object(l.a)({},e),{},Object(c.a)({},t,parseFloat(i[n+1],10)))}),{}),{PPQ:t.state.PPQ,PPQ_tempo:t.state.PPQ_tempo}),o=i[0]-(e.length-1);if(o>0)for(var u=0;u<=o;u++)e.push({measures:{}});var d=E()();return e[i[0]].measures[d]=Object(l.a)(Object(l.a)({},r),{},{id:d,inst:i[0]}),e}),[]);Z.a.log("Loaded ".concat(a," measures across ").concat(s+1," instruments.")),t.setState({instruments:i})},s.readAsText(e.target.files[0])}},{key:"render",value:function(){var e=this,t={PPQ:this.state.PPQ,PPQ_tempo:this.state.PPQ_tempo,PPQ_mod:this.state.PPQ/this.state.PPQ_tempo,range:_t(this.state.instruments.reduce((function(e,t){return Object(l.a)(Object(l.a)({},e),t.measures)}),{}))},n=this.state.instruments.map((function(e){return{measures:Object.assign({},e.measures),name:e.name}})),s=[a.a.createElement(st,{type:"text",key:"start",value:this.state.start,ref:this.insertFocusStart,id:"startInsert",placeholder:"start",name:"start",onChange:this.handleNumInput}),a.a.createElement(st,{type:"text",key:"end",value:this.state.end,ref:this.insertFocusEnd,id:"endInsert",placeholder:"end",name:"end",onChange:this.handleNumInput}),a.a.createElement(st,{type:"text",key:"timesig",value:this.state.timesig,ref:this.insertFocusTimesig,id:"timesigInsert",placeholder:"timesig",name:"timesig",onChange:this.handleNumInput})],i=["start","end","timesig"].map((function(t){return a.a.createElement(st,{id:t,type:"text",key:t,value:e.state["edit_"+t],placeholder:t,name:t,style:{float:"left"},onChange:e.handleNumEdit})})),r=ne.CANVAS_PADDING,o=r+ne.PANES_WIDTH,c=a.a.createElement("form",{onSubmit:this.handleInst,className:"inst-form",autoComplete:"off"},a.a.createElement(st,{ref:this.instNameFocus,type:"text",name:"instName",value:this.state.instName,placeholder:"NAME",onChange:this.handleNameInput}),a.a.createElement("button",{type:"submit",disabled:!this.state.instName},"\u219d")),u=this.state.instruments.map((function(t,n){var s=n*ne.INST_HEIGHT+ne.PLAYBACK_HEIGHT;return a.a.createElement(ze,{className:"pane",key:n,x:r,y:s,height:ne.TRACK_HEIGHT},a.a.createElement(Je,{x:0,y:0,onClick:function(t,s){return e.handleMuting(t,s,n)},value:"true"},"mute"),a.a.createElement(Je,{x:0,y:ne.INST_HEIGHT/3,onChange:function(t,s){return e.handleMuting(t,s,n)},value:"false"},"solo"))})),d=this.state.selected,m=d.inst>-1?this.state.instruments[d.inst]:{},f="meas"in d?d.meas:{},p=[];return d.inst>-1&&p.push(a.a.createElement("span",{key:"name"},m.name)),d.meas&&p.push(a.a.createElement("span",{key:"info"}," : ",f.start," - ",f.end," / ",f.timesig)),a.a.createElement("div",{className:"App",style:{backgroundColor:ne.secondary}},a.a.createElement(Ye,{x:600,y:0,status:this.state.isPlaying.toString(),onClick:function(){return e.play(!e.state.isPlaying,0)}},"\u262d"),a.a.createElement("div",{style:{margin:"0px"}},a.a.createElement(Ue,null,u,a.a.createElement(Ve,{x:o,y:this.state.instruments.length*ne.INST_HEIGHT+ne.PLAYBACK_HEIGHT,style:{width:"initial"}},a.a.createElement("button",{className:this.state.newInst?"opened":"closed",onClick:function(t){return e.state.newInst?e.instClose(t):e.instOpen(t)}},"+"),this.state.newInst&&c)),2===this.state.mode&&"meas"in this.state.selected?a.a.createElement(nt,{left:ne.PANES_WIDTH+ne.CANVAS_PADDING+this.state.viewport+this.state.scale*this.state.selected.meas.offset,top:ne.PLAYBACK_HEIGHT+(this.state.selected.inst+1)*ne.INST_HEIGHT,width:this.state.selected.meas.ms*this.state.scale},a.a.createElement("form",{onSubmit:this.confirmEdit,className:"measure-form",autoComplete:"off"},a.a.createElement("div",{style:{maxWidth:"150px",float:"left"}},i,a.a.createElement(rt,{type:"submit",disabled:-1===this.state.selected.inst},"\u219d")),a.a.createElement("div",{style:{float:"right"}},["s","e","d","sl","l"].map((function(t,n){return a.a.createElement(ct,{type:"button",key:t,value:n+1,onClick:function(t){return e.handleLock(n+1,t)},checked:e.state.locks.indexOf(n+1)>=0},t)}))))):null,a.a.createElement(Te,{mode:this.state.mode,locks:this.state.locks,instruments:n,panels:this.state.newInst,editMeas:this.state.editMeas,insertMeas:this.state.insertMeas,API:this.API,CONSTANTS:t}),1===this.state.mode?a.a.createElement(tt,{left:(window.innerWidth-ne.TOOLBAR_WIDTH+ne.CANVAS_PADDING)/3},a.a.createElement("form",{onSubmit:this.handleMeasure,className:"measure-form",autoComplete:"off"},s,a.a.createElement(st,{type:"text",key:"offset",value:this.state.offset,placeholder:this.state.offset||this.state.temp_offset&&this.state.cursor||"offset",name:"offset",onFocus:function(t){return e.handleOffset(!0,t)},onBlur:function(t){return e.handleOffset(!1,t)},onChange:this.handleNumInput}),a.a.createElement("button",{type:"submit",disabled:-1===this.state.selected.inst},"\u219d"))):null,a.a.createElement(et,{className:"tracking",left:(window.innerWidth-2*ne.CANVAS_PADDING-ne.TOOLBAR_WIDTH)/3+ne.CANVAS_PADDING}),2===this.state.mode?a.a.createElement(tt,{left:(window.innerWidth-ne.TOOLBAR_WIDTH+ne.CANVAS_PADDING)/3}):null,a.a.createElement(Ze,{style:{width:"".concat(window.innerWidth-ne.TOOLBAR_WIDTH-2*ne.FOOTER_PADDING,"px")}},a.a.createElement("h1",{className:"flavor",style:{display:"inline-block"}},"BANDIT"),a.a.createElement(qe,{target:"_blank",href:"https://github.com/ultraturtle0/timebandit"},a.a.createElement("img",{className:"qlink",alt:"Github link",style:{position:"relative",bottom:"5px",width:"16px"},src:Q.a})),a.a.createElement(qe,{target:"_blank",href:"https://twitter.com/j_kusel"},a.a.createElement("img",{className:"qlink",alt:"Twitter link",style:{position:"relative",bottom:"5px",width:"22px"},src:F.a})),a.a.createElement("div",{style:{position:"relative",float:"right",top:"32px"}},a.a.createElement(it,{onClick:this.settings},"settings"),a.a.createElement(it,{onClick:this.reset},"new"),a.a.createElement(it,{onClick:this.upload},"open"),a.a.createElement(it,{onClick:this.save},"save"),a.a.createElement(it,{onClick:this.midi},"export")))),a.a.createElement("form",{autoComplete:"off"},a.a.createElement("input",{id:"dummyLoad",type:"file",name:"file",onChange:this.load,hidden:!0})),a.a.createElement(Et,{show:this.state.warningNew,onHide:function(){return e.setState({warningNew:!1})},body:a.a.createElement("p",null,"Close without saving?"),buttons:[{onClick:this.save,text:"save"},{onClick:this.handleNew,text:"new file"}]}),a.a.createElement(Et,{show:this.state.warningOpen,onHide:function(){return e.setState({warningOpen:!1})},body:a.a.createElement("p",null,"Close without saving?"),buttons:[{onClick:this.open,text:"save"},{onClick:this.handleOpen,text:"open file..."}]}),a.a.createElement(bt,{show:this.state.settingsOpen,onHideCallback:this.settings,onTempoSelect:this.handleTempoPPQ,onPPQSelect:this.handlePPQ,settings:{PPQ_tempo:this.state.PPQ_tempo,PPQ_desc:this.state.PPQ_desc,PPQ:this.state.PPQ}}))}}]),n}(s.Component),Ht=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function yt(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}r.a.render(a.a.createElement(Ot,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("","/service-worker.js");Ht?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):yt(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):yt(e)}))}}()},18:function(e,t){var n=[],s=[];e.exports={hook:function(e){return n.push(e)},get:function(){return s},log:function(e){n.forEach((function(t){return t(e)})),s.push(e+"\n"),console.log(e)}}},50:function(e,t){var n=function e(t,n){return Math.abs(t.loc-n)<5?t:n<t.loc?"left"in t?e(t.left,n):(t.left={parent:t,meas:[]},t.left):"right"in t?e(t.right,n):(t.right={parent:t,meas:[]},t.right)};e.exports={tree:{find:n,edit:function(e,t){var n=t._clear,s=t._target,a=t.inst,i=t.newMeas,r=function e(t,n){var s,r,o=n._clear,c=n._target;void 0!==t&&(o&&Math.abs(t.loc-o)<5&&t.meas.splice(t.meas.indexOf(a)),c&&Math.abs(t.loc-c)<5&&(t.meas.push(i),i.beat_nodes.push(t)),o&&(s=o<t.loc?"left":"right"),c&&(t[r=c<t.loc?"left":"right"]||(t[r]={loc:c,parent:t,inst:[a],meas:[i]},r=null)),s===r?e(t[s],{_clear:o,_target:c}):(e(t[s],{_clear:o}),e(t[r],{_target:c})))};r(e,{_clear:n,_target:s,inst:a})},insert:function(e,t,s){if(!s){var a={loc:e,meas:[t]};return"beat_nodes"in t?t.beat_nodes.push(a):t.beat_nodes=[a],a}var i=n(s,e);return i.loc=e,i.meas.push(t),"node"in t?t.beat_nodes.push(i):t.beat_nodes=[i],s}}}},79:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpFNTE3OEEyQTk5QTAxMUUyOUExNUJDMTA0NkE4OTA0RCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpFNTE3OEEyQjk5QTAxMUUyOUExNUJDMTA0NkE4OTA0RCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkU1MTc4QTI4OTlBMDExRTI5QTE1QkMxMDQ2QTg5MDREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkU1MTc4QTI5OTlBMDExRTI5QTE1QkMxMDQ2QTg5MDREIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+m4QGuQAAAyRJREFUeNrEl21ojWEYx895TDPbMNlBK46IUiNmPvHBSUjaqc0H8pF5+aDUKPEBqU2NhRQpX5Rv5jWlDIWlMCv7MMSWsWwmb3tpXub4XXWdPHvc9/Gc41nu+nedc7/8r/99PffLdYdDPsvkwsgkTBwsA/PADJCnzX2gHTwBt8Hl7p537/3whn04XoDZDcpBlk+9P8AFcAghzRkJwPF4zGGw0Y9QS0mAM2AnQj77FqCzrtcwB1Hk81SYojHK4DyGuQ6mhIIrBWB9Xm7ug/6B/nZrBHBegrkFxoVGpnwBMSLR9EcEcC4qb8pP14BWcBcUgewMnF3T34VqhWMFkThLJAalwnENOAKiHpJq1FZgI2AT6HZtuxZwR9GidSHtI30jOrbawxlVX78/AbNfhHlomEUJJI89O2MqeE79T8/nk8nMBm/dK576hZgmA3cp/R4l9/UeSxiHLVIlNm4nFfT0bxyuIj7LHRTKai+zdJobwMKzcZSJb0ePV5PKN+BqAAKE47UlMnERELMM3EdYP/yrd+XYb2mOiYBiQ8OQnoRBlXrl9JZix7D1pHTazu4MoyBcnYamqAjIMTR8G4FT8LuhLsexXYYjICBiqhQBvYb6fLZIJCjPypVvaOoVAW2WcasCnL2Nq82xHJNSqlCeFcDshaPK0twkAhosjZL31QYw+1rlMpWGMArl23SBsZZO58F2tlJXmjOXS+s4WGvpMiBJT/I2PInZ6lIs9/hBsNS1hS6BG0DSqmYEDRlCXQrmy50P1oDRKTSegmNbUsA0zDMwRhPJXeCE3vWLPQMvan6X8AgIa1vcR4AkGZkDR4ejJ1UHpsaVI0g2LInpOsNFUud1rhxSV+fzC9Woz2EZkWQuja7/B+jUrgtIMpy9YCW4n4K41YfzRneW5E1KJTe4B2Zq1Q5EHEtj4U3AfEzR5SVY4l7QYQPJdN2as7RKBF0BPZqqH4VgMAMBL8Byxr7y8zCZiDlnOcEKIPmUpgB5Z2ww5RdOiiRiNajUmWda5IG6WbhsyY2fx6m8gLcoJDJFkH219M3We1+cnda93pfycZpIJEL/s/wSYADmOAwAQgdpBAAAAABJRU5ErkJggg=="},80:function(e,t,n){e.exports=n.p+"static/media/Twitter_Logo_WhiteOnImage.618d2870.svg"},93:function(e,t,n){e.exports=n(144)},98:function(e,t,n){}},[[93,1,2]]]);
//# sourceMappingURL=main.4e203b16.chunk.js.map